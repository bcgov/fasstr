<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Water knows no borders: using USGS dataRetrieval R package with fasstr • fasstr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Water knows no borders: using USGS dataRetrieval R package with fasstr">
<meta property="og:description" content="fasstr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">fasstr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../../articles/fasstr.html">Get Started</a>
</li>
<li>
  <a href="../../reference/index.html">Functions</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/index.html">All Articles</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Tutorials</li>
    <li>
      <a href="../../articles/fasstr_users_guide.html">General Usage</a>
    </li>
    <li>
      <a href="../../articles/fasstr_trending_analysis.html">Computing Annual Trends</a>
    </li>
    <li>
      <a href="../../articles/fasstr_frequency_analysis.html">Computing Volume Frequency Analyses</a>
    </li>
    <li>
      <a href="../../articles/fasstr_full_analysis.html">Computing a Full Analysis</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Exploration</li>
    <li>
      <a href="../../articles/articles/fasstr_dataRetrieval.html">Using USGS dataRetrieval data with fasstr</a>
    </li>
    <li class="divider">
    <li class="dropdown-header">Under the Hood</li>
    <li>
      <a href="../../articles/fasstr_under_the_hood.html">Internal Workflows</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/bcgov/fasstr/raw/master/fasstr_cheatsheet.pdf">
    <span class="fa fa-file-download"></span>
     
    Download Cheatsheet
  </a>
</li>
<li>
  <a href="https://github.com/bcgov/fasstr">
    <span class="fa fa-github fa-lg"></span>
     
    GitHub
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="fasstr_dataRetrieval_files/header-attrs-2.11/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Water knows no borders: using USGS dataRetrieval R package with fasstr</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/bcgov/fasstr/blob/master/vignettes/articles/fasstr_dataRetrieval.Rmd"><code>vignettes/articles/fasstr_dataRetrieval.Rmd</code></a></small>
      <div class="hidden name"><code>fasstr_dataRetrieval.Rmd</code></div>

    </div>

    
    
<p><code>fasstr</code>, the Flow Analysis Summary Statistics Tool for R, is a set of <a href="https://www.r-project.org/">R</a> functions to tidy, summarize, analyze, trend, and visualize streamflow data. This package summarizes continuous daily mean streamflow data into various daily, monthly, annual, and long-term statistics, completes trending and frequency analyses.</p>
<p>This vignette explores how to obtain and integrate U.S. Geological Survey (USGS) streamflow data, available through the <a href="https://waterdata.usgs.gov/nwis">National Water Information System (NWIS)</a> using the <a href="https://cran.r-project.org/package=dataRetrieval"><code>dataRetrieval</code> R package</a>, with the various <code>fasstr</code> functions.</p>
<p>This vignette will use the following packages:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://bcgov.github.io/fasstr/">fasstr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pubs.usgs.gov/tm/04/a10/">dataRetrieval</a></span><span class="op">)</span> <span class="co"># for getting USGS NWIS data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/tidyhydat/">tidyhydat</a></span><span class="op">)</span> <span class="co"># for getting ECCC HYDAT data</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span> <span class="co"># for data wrangling and pipelines</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span> <span class="co"># for modifying fasstr plots</span></code></pre></div>
<div id="dataretrieval-package" class="section level2">
<h2 class="hasAnchor">
<a href="#dataretrieval-package" class="anchor"></a>dataRetrieval Package</h2>
<p><code>dataRetrieval</code> is an R package with a collection of functions to retrieve hydrologic and water quality data hosted on USGS and U.S. Environmental Protection Agency (EPA) web services. USGS hydrologic data are pulled from <a href="https://waterservices.usgs.gov/" class="uri">https://waterservices.usgs.gov/</a> and <a href="https://waterdata.usgs.gov/nwis" class="uri">https://waterdata.usgs.gov/nwis</a>. Water quality data are obtained from the Water Quality Portal <a href="https://www.waterqualitydata.us/" class="uri">https://www.waterqualitydata.us/</a>. More information on using <code>dataRetrieval</code> can be found in the <a href="https://cran.r-project.org/web/packages/dataRetrieval/vignettes/dataRetrieval.html">vignette</a>.</p>
<p>This package is another useful tool for hydrologists, especially for those looking to use USGS streamflow hydrometric station data with <code>fasstr</code> or other streamflow packages and analyses. You can search for stations on the NWIS website <a href="https://waterdata.usgs.gov/nwis/rt" class="uri">https://waterdata.usgs.gov/nwis/rt</a>. Unlike the <code>tidyhydat</code> package to obtain Environment and Climate Change Canada’s (ECCC) HYDAT historical discharge data, <code>dataRetrieval</code> pulls all data from the NWIS web services and does not require downloading and storing a database.</p>
<p>As USGS stations collect more than just streamflow, a parameter code is required for many of the functions to choose the appropriate data type. The parameter code for daily mean discharge data is “00060”. The units of this discharge parameter are in US customary cubic feet per second (cfs). While using US customary units is not an issue for many <code>fasstr</code> functions, as units do not matter for many analyses or plots titles and column headers can simply be renamed, there are some functions that use internal metric unit conversions so some adaptations will be required (see sections below).</p>
<p>Here is a quick workflow demo showing how to get hydrometric station information, and daily and annual peak data using <code>dataRetrieval</code>, adapted from the <a href="https://cran.r-project.org/web/packages/dataRetrieval/vignettes/dataRetrieval.html">vignette</a>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Hoko River Near Sekiu, WA (12043300)</span>
<span class="va">site_number</span> <span class="op">&lt;-</span> <span class="st">"12043300"</span> 

<span class="co"># Get site information (i.e. name, coordinates, drainage basin area, etc.)</span>
<span class="va">site_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span><span class="va">site_number</span><span class="op">)</span>

<span class="co"># Get daily discharge data</span>
<span class="co"># Requires parameter code for discharge (00060), in cubic feet per second (cfs)</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="va">site_number</span>,
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span>, 
                        startDate <span class="op">=</span> <span class="st">"1980-01-01"</span>,
                        endDate <span class="op">=</span> <span class="st">"2019-12-31"</span><span class="op">)</span>

<span class="co"># Get annual instantaneous peak discharge data (based on water years (Oct-Sep))</span>
<span class="va">peak_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISpeak.html">readNWISpeak</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="va">site_number</span><span class="op">)</span></code></pre></div>
</div>
<div id="converting-to-metric-and-fasstr-default-columns" class="section level2">
<h2 class="hasAnchor">
<a href="#converting-to-metric-and-fasstr-default-columns" class="anchor"></a>Converting to metric and fasstr default columns</h2>
<p>For metric discharge analyses using NWIS data from the USGS, discharge values can easily be converted to cms from cfs (0.028317 cms per cfs) for use in <code>fasstr</code>.</p>
<p>The default <code>dataRetrieval</code> NWIS data column formats are as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span></code></pre></div>
<pre><code>##   agency_cd  site_no       Date X_00060_00003 X_00060_00003_cd
## 1      USGS 12043300 1962-08-01            25                A
## 2      USGS 12043300 1962-08-02            27                A
## 3      USGS 12043300 1962-08-03            40                A
## 4      USGS 12043300 1962-08-04            40                A
## 5      USGS 12043300 1962-08-05            60                A
## 6      USGS 12043300 1962-08-06            88                A</code></pre>
<div id="keeping-nwis-column-names" class="section level3">
<h3 class="hasAnchor">
<a href="#keeping-nwis-column-names" class="anchor"></a>Keeping NWIS column names</h3>
<p>To keep the NWIS data column names for <code>fasstr</code> functions, just remember to convert the discharge units and then send to <code>fasstr</code> functions using the ‘values’ argument. Date column names are the same in both NWIS and HYDAT data. Here is an example of this situation using base R:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>

<span class="co"># Get cfs data</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>,
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>

<span class="co"># Convert cfs to cms</span>
<span class="va">usgs_data</span><span class="op">$</span><span class="va">X_00060_00003</span> <span class="op">&lt;-</span> <span class="va">usgs_data</span><span class="op">$</span><span class="va">X_00060_00003</span> <span class="op">*</span> <span class="va">cfs_to_cms</span>

<span class="co"># Set `values` and 'groups' (if multiple stations) to the appropriate column names</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>,
               values <span class="op">=</span> <span class="va">X_00060_00003</span>,
               groups <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span></code></pre></div>
<p>and using <code>dplyr</code> and pipelines:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>

<span class="co"># One station</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>X_00060_00003 <span class="op">=</span> <span class="va">X_00060_00003</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>,
               values <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span>

<span class="co"># Multiple stations</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>,
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>X_00060_00003 <span class="op">=</span> <span class="va">X_00060_00003</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>,
               values <span class="op">=</span> <span class="va">X_00060_00003</span>,
               groups <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span></code></pre></div>
</div>
<div id="renaming-nwis-column-names" class="section level3">
<h3 class="hasAnchor">
<a href="#renaming-nwis-column-names" class="anchor"></a>Renaming NWIS column names</h3>
<p>NWIS column names can also be changed to match those with <code>tidyhydat</code> and <code>fasstr</code>‘s defaults data column names (i.e. ’STATION_NUMBER’, ‘Date’, and ‘Value’) to work easily with <code>fasstr</code>. Renaming ‘site_no’ to ‘STATION_NUMBER’ is not necessary if one station is used, but is useful if data contains multiple stations. Here is an example of this situation using base R:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the data</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>

<span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>

<span class="co"># Rename columns</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'site_no'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'STATION_NUMBER'</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'X_00060_00003'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Value'</span>

<span class="co"># Convert cfs to cms</span>
<span class="va">usgs_data</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">usgs_data</span><span class="op">$</span><span class="va">Value</span> <span class="op">*</span> <span class="va">cfs_to_cms</span>

<span class="co"># Use a fasstr function</span>
<span class="fu"><a href="../../reference/calc_annual_peaks.html">calc_annual_peaks</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span></code></pre></div>
<p>and using <code>dplyr</code> and pipelines:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>

<span class="co"># One station</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">Value</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span>

<span class="co"># Multiple stations</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>STATION_NUMBER <span class="op">=</span> <span class="va">site_no</span>, 
         Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">Value</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span>

<span class="co"># Use a fasstr function</span>
<span class="fu"><a href="../../reference/calc_annual_peaks.html">calc_annual_peaks</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span></code></pre></div>
</div>
<div id="getting-and-converting-drainage-basin-areas" class="section level3">
<h3 class="hasAnchor">
<a href="#getting-and-converting-drainage-basin-areas" class="anchor"></a>Getting and converting drainage basin areas</h3>
<p>Some <code>fasstr</code> functions require an upstream drainage basin area to calculate discharge as area-based runoff yield statistics (in depth units, commonly millimetres in Canada). NWIS upstream drainage basin areas (in square miles) can be found in the site information using the <code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">dataRetrieval::readNWISsite()</a></code> function and then can be converted to square kilometres (2.58999 sqkm per sqmile):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>
<span class="co"># Conversion factor from sq. miles to sq. km</span>
<span class="va">sqmile_to_sqkm</span> <span class="op">&lt;-</span> <span class="fl">2.58999</span>

<span class="co"># Get station information</span>
<span class="va">site_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span>

<span class="co"># Get the drainage area and convert to sq. km</span>
<span class="va">basin_area_NWIS</span> <span class="op">&lt;-</span> <span class="va">site_info</span><span class="op">$</span><span class="va">drain_area_va</span> <span class="op">*</span> <span class="va">sqmile_to_sqkm</span>

<span class="co"># Get data and apply to fasstr function</span>
<span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
           parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">Value</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/plot_daily_cumulative_stats.html">plot_daily_cumulative_stats</a></span><span class="op">(</span>basin_area <span class="op">=</span> <span class="va">basin_area_NWIS</span>, 
                              use_yield <span class="op">=</span> <span class="cn">TRUE</span>,
                              add_year <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></code></pre></div>
<p>Here is one way of providing multiple basin areas for multiple stations:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Conversion factor from cfs to cms</span>
<span class="va">cfs_to_cms</span> <span class="op">&lt;-</span> <span class="fl">0.028317</span>
<span class="co"># Conversion factor from sq. miles to sq. km</span>
<span class="va">sqmile_to_sqkm</span> <span class="op">&lt;-</span> <span class="fl">2.58999</span>

<span class="co"># Get station information</span>
<span class="va">site_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">site_no</span>, <span class="va">drain_area_va</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Basin_Area_sqkm <span class="op">=</span> <span class="va">drain_area_va</span> <span class="op">*</span> <span class="va">sqmile_to_sqkm</span><span class="op">)</span>

<span class="co"># Create named vector of areas to send to basin area</span>
<span class="va">areas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html">setNames</a></span><span class="op">(</span><span class="va">site_info</span><span class="op">$</span><span class="va">Basin_Area_sqkm</span>, <span class="va">site_info</span><span class="op">$</span><span class="va">site_no</span><span class="op">)</span>

<span class="co"># Get data and apply to fasstr function</span>
<span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>, 
           parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span>, 
         STATION_NUMBER <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">Value</span> <span class="op">*</span> <span class="va">cfs_to_cms</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/plot_daily_cumulative_stats.html">plot_daily_cumulative_stats</a></span><span class="op">(</span>use_yield <span class="op">=</span> <span class="cn">TRUE</span>,
                              basin_area <span class="op">=</span> <span class="va">areas</span>,
                              add_year <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></code></pre></div>
</div>
<div id="handy-formatting-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#handy-formatting-functions" class="anchor"></a>Handy formatting functions</h3>
<p>Functions can also be created if conversions will frequently occur within workflows. The first example here converts and formats data already downloaded using <code>dataRetrieval</code>’s <code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv()</a></code> function for <code>fasstr</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create function to convert to metric and HYDAT structure</span>
<span class="va">usgs_to_hydat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'site_no'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'STATION_NUMBER'</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'X_00060_00003'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Value'</span>
  <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">*</span> <span class="fl">0.028317</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Get data, convert, and send to fasstr function:</span>
<span class="co"># in base R</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span><span class="st">"12043300"</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu">usgs_to_hydat</span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span>
<span class="fu"><a href="../../reference/calc_annual_stats.html">calc_annual_stats</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span>

<span class="co"># and in a pipeline</span>
<span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span><span class="st">"12043300"</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">usgs_to_hydat</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/calc_annual_stats.html">calc_annual_stats</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This second function integrates <code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv()</a></code> with the first function that will both download and convert the data for <code>fasstr</code> functions by supplying NWIS site numbers:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create function to download NWIS data and convert to metric and HYDAT structure</span>
<span class="va">readNWISdv_hydat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">siteNumbers</span><span class="op">)</span><span class="op">{</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="va">siteNumbers</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'site_no'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'STATION_NUMBER'</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'X_00060_00003'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Value'</span>
  <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">*</span> <span class="fl">0.028317</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Get data, convert, and send to fasstr function:</span>
<span class="co"># in base R</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu">readNWISdv_hydat</span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/calc_annual_stats.html">calc_annual_stats</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span>

<span class="co"># and in a pipeline</span>
<span class="fu">readNWISdv_hydat</span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/calc_annual_stats.html">calc_annual_stats</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>This third function is the same as the second, but adds a column of drainage basin areas, in square kilometres, extracted and converted from NWIS:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create function to download NWIS data and convert to metric and HYDAT structure</span>
<span class="va">readNWISdv_hydat</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">siteNumbers</span><span class="op">)</span><span class="op">{</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="va">siteNumbers</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'site_no'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'STATION_NUMBER'</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'X_00060_00003'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Value'</span>
  <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">Value</span> <span class="op">*</span> <span class="fl">0.028317</span>
  
  <span class="va">basin_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="va">siteNumbers</span><span class="op">)</span>
  <span class="va">basin_area</span><span class="op">$</span><span class="va">Basin_Area_sqkm</span> <span class="op">&lt;-</span> <span class="va">basin_area</span><span class="op">$</span><span class="va">drain_area_va</span> <span class="op">*</span> <span class="fl">2.58999</span>
  <span class="va">basin_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>STATION_NUMBER <span class="op">=</span> <span class="va">basin_area</span><span class="op">$</span><span class="va">site_no</span>,
                           Basin_Area_sqkm <span class="op">=</span> <span class="va">basin_area</span><span class="op">$</span><span class="va">Basin_Area_sqkm</span><span class="op">)</span>
  
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">basin_area</span>, by <span class="op">=</span> <span class="st">"STATION_NUMBER"</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Get data and convert data:</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu">readNWISdv_hydat</span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="working-in-us-customary-units" class="section level2">
<h2 class="hasAnchor">
<a href="#working-in-us-customary-units" class="anchor"></a>Working in US customary units</h2>
<p>For analyses using US customary units from USGS NWIS data from <code>dataRetrieval</code>, most <code>fasstr</code> functions will work with little to no issues. Most functions take the provided data (i.e. flows in cfs) and provide means, medians, percentiles, etc. For data frame outputs, it can be assumed that if there are no units in column names that units are the same as the data provided. Axes labeled ‘Discharge (cms)’ on plots can simply be renamed to match the units by extracting the plot object from its listed object (using double square brackets <code>[[1]]</code>, or <code><a href="https://magrittr.tidyverse.org/reference/aliases.html">magrittr::extract2(1)</a></code> in a pipeline) and using <code>ggplot2</code> functions (eg. <code>+ ylab('Discharge, cubic feet per second')</code>). If units are expressed in Volume_m3 it can be interpreted as cubic feet volume and renamed as such. However, if column names or plots titles are labeled as Yield_mm, there will there be additional conversion steps (see section below) required to get the appropriate inches depth.</p>
<div id="keeping-nwis-column-names-1" class="section level3">
<h3 class="hasAnchor">
<a href="#keeping-nwis-column-names-1" class="anchor"></a>Keeping NWIS column names</h3>
<p>NWIS data column names from <code>dataRetrieval</code> can easily be used with <code>fasstr</code> functions, with setting <code>values = X_00060_00003</code> or <code>values = 'X_00060_00003'</code> to identify the flow values column in <code>fasstr</code> functions. If there are multiple stations in a data frame, the stations can be grouped separately by identifying them using <code>groups = site_no</code> or <code>groups = 'site_no'</code>. Date column names are the same in both NWIS and HYDAT data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># One station</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>,
               values <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span>

<span class="co"># Multiple stations</span>
<span class="va">usgs_data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>,
                                 parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data_multiple</span>,
               values <span class="op">=</span> <span class="va">X_00060_00003</span>,
               groups <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span>

<span class="co"># Calculate stats using water years</span>
<span class="fu"><a href="../../reference/calc_longterm_mean.html">calc_longterm_mean</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>, 
                   values <span class="op">=</span> <span class="va">X_00060_00003</span>,
                   water_year_start <span class="op">=</span> <span class="fl">10</span>, 
                   complete_years <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
</div>
<div id="renaming-nwis-column-names-1" class="section level3">
<h3 class="hasAnchor">
<a href="#renaming-nwis-column-names-1" class="anchor"></a>Renaming NWIS column names</h3>
<p>NWIS column names can also be changed to match those with <code>tidyhydat</code> and <code>fasstr</code>‘s defaults data column names (i.e. ’STATION_NUMBER’, ‘Date’, and ‘Value’) to work easily with <code>fasstr</code>. Using original names is good for quick function use, but renaming to the HYDAT convention makes using multiple <code>fasstr</code> functions easier. Renaming ‘site_no’ to ‘STATION_NUMBER’ is not necessary if one station is used, but is useful if data contains multiple stations. Here is an example of this situation using base R:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the data</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span>

<span class="co"># Rename columns</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'site_no'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'STATION_NUMBER'</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span> <span class="op">==</span> <span class="st">'X_00060_00003'</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="st">'Value'</span></code></pre></div>
<p>and using <code>dplyr</code> and pipelines:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># One station</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span>

<span class="co"># Multiple stations</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>STATION_NUMBER <span class="op">=</span> <span class="va">site_no</span>, 
         Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span></code></pre></div>
</div>
<div id="use-of-drainage-basin-areas" class="section level3">
<h3 class="hasAnchor">
<a href="#use-of-drainage-basin-areas" class="anchor"></a>Use of drainage basin areas</h3>
<p>Some <code>fasstr</code> functions use require drainage basin areas to calculate discharge as area-based runoff yield statistics (in depth units). Since <code>fasstr</code> internally converts discharge using metric conversions, this makes conversions of US customary cubic feet per second and square miles to inches depth not as simple. Luckily, if your discharge units are in cubic feet per second and basin ares in square miles, a simple workaround can be applied to get inches depth: multiply the basin area by 2323.2. This number is derived from three US/metric unit conversions that magically provide the proper conversion:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># sqkm/sqmiles / (inches/mm * cms/cfs)</span>
<span class="fl">2.58999</span> <span class="op">/</span> <span class="op">(</span><span class="fl">0.0393701</span> <span class="op">*</span> <span class="fl">0.028316846592</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] 2323.2</code></pre>
<p>So if using any functions that result in yield values (typically ‘yield’ or ‘cumulative’ functions that with columns or axes with yield names when using <code>use_yield = TRUE</code>), then the multiplier needs to be applied to square mile basin areas. NWIS upstream drainage basin areas can be found in the site information using the <code>dataRetrieval</code> <code><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite()</a></code> function. The following is an example of how to use the workaround, with appropriate renaming of columns or plot axes:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get a NWIS basin area</span>
<span class="va">area_sqmile</span> <span class="op">&lt;-</span> <span class="fu">dataRetrieval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">drain_area_va</span><span class="op">)</span>

<span class="co"># Drainage basin area conversion for fasstr</span>
<span class="va">area_adjust</span> <span class="op">&lt;-</span> <span class="fl">2323.2</span>

<span class="co"># Get NWIS data</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span><span class="op">)</span>

<span class="co"># Add daily yield in inches, with 2323.2 basin area multiplier</span>
<span class="fu"><a href="../../reference/add_daily_yield.html">add_daily_yield</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>,
                basin_area <span class="op">=</span> <span class="va">area_sqmile</span> <span class="op">*</span> <span class="va">area_adjust</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Yield_inch <span class="op">=</span> <span class="va">Yield_mm</span><span class="op">)</span>

<span class="co"># Calculate total annual inches, with multiplier</span>
<span class="fu"><a href="../../reference/calc_annual_cumulative_stats.html">calc_annual_cumulative_stats</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>, 
                             use_yield <span class="op">=</span> <span class="cn">TRUE</span>,
                             basin_area <span class="op">=</span> <span class="va">area_sqmile</span> <span class="op">*</span> <span class="va">area_adjust</span>,
                             water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Total_Yield_inch <span class="op">=</span> <span class="va">Total_Yield_mm</span><span class="op">)</span>

<span class="co"># Plot daily cumulative discharge, with multiplier</span>
<span class="fu"><a href="../../reference/plot_daily_cumulative_stats.html">plot_daily_cumulative_stats</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_data</span>, 
                            use_yield <span class="op">=</span> <span class="cn">TRUE</span>,
                            basin_area <span class="op">=</span> <span class="va">area_sqmile</span> <span class="op">*</span> <span class="va">area_adjust</span>,
                            water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">magrittr</span><span class="fu">::</span><span class="fu"><a href="https://magrittr.tidyverse.org/reference/aliases.html">extract2</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="co"># extracts plot from list</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Runoff, inch"</span><span class="op">)</span></code></pre></div>
</div>
<div id="examples-data-wrangling" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-data-wrangling" class="anchor"></a>Examples: data wrangling</h3>
<p>For the rest of the vignette examples, we will set up data frames of daily stream discharge from <code>dataRetrieval</code> called <code>usgs_data</code> and <code>usgs_data_multiple</code>, and rename the columns to match the <code>fasstr</code> defaults (i.e. STATION_NUMBER, Date, and Value). We will also extract a basin area for the <code>usgs_data</code> data set.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get daily data for examples</span>
<span class="va">usgs_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span>, 
                        parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span>,
         STATION_NUMBER <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span>

<span class="co"># Get drainage basin area for examples</span>
<span class="va">usgs_basin_area</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISsite.html">readNWISsite</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="st">"12043300"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">drain_area_va</span><span class="op">)</span>

<span class="co"># Get daily data for examples with multiple stations</span>
<span class="va">usgs_data_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISdv.html">readNWISdv</a></span><span class="op">(</span>siteNumbers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"12043300"</span>, <span class="st">"12048000"</span><span class="op">)</span>, 
                                 parameterCd <span class="op">=</span> <span class="st">"00060"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Value <span class="op">=</span> <span class="va">X_00060_00003</span>,
         STATION_NUMBER <span class="op">=</span> <span class="va">site_no</span><span class="op">)</span></code></pre></div>
<p>To be consistent with many USGS streamflow analyses, these examples will use Water Years (from Oct-Sep) instead of Calendar Years by setting <code>water_year_start = 10</code> in the necessary functions. With <code>fasstr</code> a water year is identified by the calendar year in which it ends. For example, a water year from October 2019 to September 2020 will be identified as 2020.</p>
</div>
<div id="examples-tidying-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-tidying-functions" class="anchor"></a>Examples: tidying functions</h3>
<p>There are several functions that are used to prepare your flow data set for your own analyses by adding columns of various date variables, adding rolling means, and adding cumulative discharges, amongst others. These functions begin with <code>add_</code> or <code>fill_</code> and add columns or rows, respectively, to your data frame of daily flow values. See the documentation for more info on the functions. The following example shows how to apply the tidying functions in a continuous pipeline and using water years. Note how the basin area correction is applied in the two <code>_cumulative_</code> functions and columns are renamed to match the appropriate units where necessary.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">usgs_data</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/fill_missing_dates.html">fill_missing_dates</a></span><span class="op">(</span>water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_date_variables.html">add_date_variables</a></span><span class="op">(</span>water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_seasons.html">add_seasons</a></span><span class="op">(</span>water_year_start <span class="op">=</span> <span class="fl">10</span>,
              seasons_length <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_rolling_means.html">add_rolling_means</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_daily_volume.html">add_daily_volume</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Volume_cuft <span class="op">=</span> <span class="va">Volume_m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_cumulative_volume.html">add_cumulative_volume</a></span><span class="op">(</span>water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Cumul_Volume_cuft <span class="op">=</span> <span class="va">Cumul_Volume_m3</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/add_daily_yield.html">add_daily_yield</a></span><span class="op">(</span>basin_area <span class="op">=</span> <span class="va">usgs_basin_area</span> <span class="op">*</span> <span class="fl">2323.2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Yield_inch <span class="op">=</span> <span class="va">Yield_mm</span><span class="op">)</span> <span class="op">%&gt;%</span>  
  <span class="fu"><a href="../../reference/add_cumulative_yield.html">add_cumulative_yield</a></span><span class="op">(</span>water_year_start <span class="op">=</span> <span class="fl">10</span>, 
                       basin_area <span class="op">=</span> <span class="va">usgs_basin_area</span> <span class="op">*</span> <span class="fl">2323.2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>Cumul_Yield_inch <span class="op">=</span> <span class="va">Cumul_Yield_mm</span><span class="op">)</span></code></pre></div>
</div>
<div id="examples-flow-data-screening" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-flow-data-screening" class="anchor"></a>Examples: flow data screening</h3>
<p>It may be useful to explore data availability and quality before using the data for analysis. Some of the screening functions can help you screen for outliers and missing data. Note the renaming of axis labels in the plot examples to the necessary units with one or multiple station plots.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the number of missing dates and some basic summary statistics (calculated regardless </span>
<span class="co"># of missing dates)</span>
<span class="fu"><a href="../../reference/screen_flow_data.html">screen_flow_data</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                 water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Plot the missing dates</span>
<span class="fu"><a href="../../reference/plot_missing_dates.html">plot_missing_dates</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                   water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Plot the data, extract the plot, and rename the axis</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Discharge, cfs"</span><span class="op">)</span>

<span class="co"># Alternatively, plot the data, and rename the axis label by modifying the ggplot code</span>
<span class="va">usgs_daily_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span><span class="va">usgs_data</span><span class="op">)</span>
<span class="va">usgs_daily_plot</span><span class="op">$</span><span class="va">Daily_Flows</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cfs"</span>
<span class="va">usgs_daily_plot</span>

<span class="co"># Plotting daily flows of multiple stations on one plot, extracting and renaming axis</span>
<span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span><span class="va">usgs_data_multiple</span>, 
               one_plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Discharge, cfs"</span><span class="op">)</span>

<span class="co"># Plotting daily flows of multiple stations on different plots, and</span>
<span class="co"># renaming axes of existing ggplot2 objects</span>
<span class="va">usgs_daily_multiple</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/plot_flow_data.html">plot_flow_data</a></span><span class="op">(</span><span class="va">usgs_data_multiple</span><span class="op">)</span>
<span class="va">usgs_daily_multiple</span><span class="op">$</span><span class="va">`12043300_Daily_Flows`</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cfs"</span>
<span class="va">usgs_daily_multiple</span><span class="op">$</span><span class="va">`12048000_Daily_Flows`</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cfs"</span>
<span class="va">usgs_daily_multiple</span></code></pre></div>
</div>
<div id="examples-summary-statistics-tables-and-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-summary-statistics-tables-and-plots" class="anchor"></a>Examples: summary statistics tables and plots</h3>
<p>The majority of the <code>fasstr</code> functions produce statistics over a certain time period, either long-term, annually, monthly, or daily. These statistics are produced using the <code>calc_</code> functions and many can be visualized using corresponding <code>plot_</code> functions. Most of the <code>calc_</code> functions do not require any changes to column names, unless they require as drainage basin area, where the multiplier fix will be applied. Most of the plots will require renaming axes as noted.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate long-term and long-term monthly summary statistics based on daily data</span>
<span class="co"># using only years with complete data</span>
<span class="fu"><a href="../../reference/calc_longterm_daily_stats.html">calc_longterm_daily_stats</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                          water_year_start <span class="op">=</span> <span class="fl">10</span>,
                          complete_years <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Calculate the long-term mean annual discharge (MAD) using only years with complete </span>
<span class="co"># data and calculate 5%, 10%, and 20% MADs, for multiple stations</span>
<span class="fu"><a href="../../reference/calc_longterm_mean.html">calc_longterm_mean</a></span><span class="op">(</span><span class="va">usgs_data_multiple</span>, 
                   water_year_start <span class="op">=</span> <span class="fl">10</span>, 
                   complete_years <span class="op">=</span> <span class="cn">TRUE</span>,
                   percent_MAD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">10</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Plot flow duration curves for each month and combining summer months, using only </span>
<span class="co"># complete years, and renaming the axis title</span>
<span class="fu"><a href="../../reference/plot_flow_duration.html">plot_flow_duration</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                   water_year_start <span class="op">=</span> <span class="fl">10</span>, 
                   complete_years <span class="op">=</span> <span class="cn">TRUE</span>,
                   custom_months <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span>,
                   custom_months_label <span class="op">=</span> <span class="st">"Summer"</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Discharge, cubic feet per second"</span><span class="op">)</span>

<span class="co"># Plot annual summary statistics, including annual 10th and 90th percentiles, starting</span>
<span class="co"># in 1996 and making the axis logarithmic, and renaming the axis title</span>
<span class="fu"><a href="../../reference/plot_annual_stats.html">plot_annual_stats</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                  water_year_start <span class="op">=</span> <span class="fl">10</span>,
                  percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">90</span><span class="op">)</span>,
                  start_year <span class="op">=</span> <span class="fl">1996</span>,
                  log_discharge <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Discharge, cubic feet per second"</span><span class="op">)</span>

<span class="co"># Calculate annual 7- and 30-day low flows</span>
<span class="fu"><a href="../../reference/calc_annual_lowflows.html">calc_annual_lowflows</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                     roll_days <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">30</span><span class="op">)</span>,
                     water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Plot the winter-spring (Jan-July) center of volume dates for</span>
<span class="co"># multiple stations</span>
<span class="fu"><a href="../../reference/plot_annual_flow_timing.html">plot_annual_flow_timing</a></span><span class="op">(</span><span class="va">usgs_data_multiple</span>,
                        percent_total <span class="op">=</span> <span class="fl">50</span>,
                        water_year_start <span class="op">=</span> <span class="fl">10</span>,
                        months <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">7</span><span class="op">)</span>

<span class="co"># Plot annual means, starting in 1996</span>
<span class="fu"><a href="../../reference/plot_annual_means.html">plot_annual_means</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                  water_year_start <span class="op">=</span> <span class="fl">10</span>,
                  start_year <span class="op">=</span> <span class="fl">1996</span><span class="op">)</span>

<span class="co"># Calculate monthly summary statistics, including 25 and 27 percentiles</span>
<span class="fu"><a href="../../reference/calc_monthly_stats.html">calc_monthly_stats</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                   percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span>,
                   water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Calculate daily summary statistics, including 25th and 75th percentiles</span>
<span class="fu"><a href="../../reference/calc_daily_stats.html">calc_daily_stats</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                 percentiles <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">25</span>,<span class="fl">75</span><span class="op">)</span>,
                 water_year_start <span class="op">=</span> <span class="fl">10</span>,
                 complete_years <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Plot an annual hydrograph (daily summary statistics) using only data </span>
<span class="co"># from complete years and add 2020 daily data for comparison, for multiple stations</span>
<span class="fu"><a href="../../reference/plot_daily_stats.html">plot_daily_stats</a></span><span class="op">(</span><span class="va">usgs_data_multiple</span>,
                 complete_years <span class="op">=</span> <span class="cn">TRUE</span>,
                 add_year <span class="op">=</span> <span class="fl">2020</span>,
                 water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>

<span class="co"># Plot an annual cumulative runoff hydrograph (daily summary statistics) and adding</span>
<span class="co"># 2020 daily data, using the basin area and correction factor, and renaming the axis</span>
<span class="fu"><a href="../../reference/plot_daily_cumulative_stats.html">plot_daily_cumulative_stats</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                            add_year <span class="op">=</span> <span class="fl">2020</span>,
                            use_yield <span class="op">=</span> <span class="cn">TRUE</span>,
                            basin_area <span class="op">=</span> <span class="va">usgs_basin_area</span> <span class="op">*</span> <span class="fl">2323.2</span>,
                            water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Cumulative Runoff, inches"</span><span class="op">)</span></code></pre></div>
</div>
<div id="examples-annual-trending" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-annual-trending" class="anchor"></a>Examples: annual trending</h3>
<p>The <code><a href="../../reference/compute_annual_trends.html">compute_annual_trends()</a></code> function trends annual streamflow metrics using prewhitened non-parametric Mann-Kendall tests using the <a href="https://CRAN.R-project.org/package=zyp"><code>zyp</code></a> package. The function calculates various annual metrics using the <code><a href="../../reference/calc_all_annual_stats.html">calc_all_annual_stats()</a></code> <code>fasstr</code> function and then calculates and plots the trending data. The <code>zhang</code> prewhitening method is recommended for hydrologic applications over <code>yuepilon</code>. See the <a href="https://CRAN.R-project.org/package=zyp"><code>zyp</code></a> package and the <a href="https://bcgov.github.io/fasstr/articles/fasstr_trending_analysis.html">trending vignette</a> for more information.</p>
<p>For the trending function, many of the metrics and results are simply statistics on the raw data and so will not require any conversions. However, like other <code>fasstr</code> functions that calculate volumetric and runoff totals (using a basin area), some fixes will be required to use a basin area (see above) and to rename data, columns, and plot axes. Data and axes with names ending with units of volume or yield will require renaming. The following code is examples of how to run the trending function and modify it and the outputs for US units.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Calculate annual metrics and trend the data using the Mann-Kendall methods, </span>
<span class="co"># using 'zhang' prewhitening methods, plotting a trend line on plots if α &lt; 0.05,</span>
<span class="co"># and applying the basin area correction to get inches depth for yield units.</span>
<span class="va">trends</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/compute_annual_trends.html">compute_annual_trends</a></span><span class="op">(</span><span class="va">usgs_data</span>, 
                                zyp_method <span class="op">=</span> <span class="st">"zhang"</span>, 
                                zyp_alpha <span class="op">=</span> <span class="fl">0.05</span>,
                                basin_area <span class="op">=</span> <span class="va">usgs_basin_area</span> <span class="op">*</span> <span class="fl">2323.2</span>,
                                water_year_start <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></code></pre></div>
<p>While exported values will be accurate, some data, columns, and axes will needed to be renamed from metric to US units. If want to use results from above, then here are some ways to convert names in the output from <code>compute_annual_trends</code>:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Rename plot names</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Rename the Statistics in Data and Results</span>
<span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
<span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
<span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
<span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>

<span class="co"># Rename y-axes and titles in plots</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Discharge (cms)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'cms'</span>, <span class="st">'cfs'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Yield (mm)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'mm'</span>, <span class="st">'inch'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
    <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span><span class="op">)</span>
  <span class="op">}</span>
  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Volume (cubic metres)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'metres'</span>, <span class="st">'feet'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
    <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>A function can also be written if relabeling will frequently occur within workflows. With this example, you apply the output of <code><a href="../../reference/compute_annual_trends.html">compute_annual_trends()</a></code> directly to this wrapper function and it will rename all appropriate labels and titles within the results.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create wrapper function</span>
<span class="va">fasstr_trends_to_US_units</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">{</span>
  
  <span class="co"># Rename plot names</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">)</span>
  
  <span class="co"># Rename the Statistics in Data and Results</span>
  <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
  <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Data</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
  <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
  <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">$</span><span class="va">Annual_Trends_Results</span><span class="op">$</span><span class="va">Statistic</span><span class="op">)</span>
  
  <span class="co"># Rename y-axes and titles in plots</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Discharge (cms)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'cms'</span>, <span class="st">'cfs'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Yield (mm)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'mm'</span>, <span class="st">'inch'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
      <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_mm'</span>, <span class="st">'_inch'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span><span class="op">)</span>
    <span class="op">}</span>
    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html">all</a></span><span class="op">(</span><span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">==</span> <span class="st">"Volume (cubic metres)"</span><span class="op">)</span><span class="op">)</span><span class="op">{</span>
      <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'metres'</span>, <span class="st">'feet'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span><span class="op">)</span>
      <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'_m3'</span>, <span class="st">'_cuft'</span>, <span class="va">trends</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">title</span><span class="op">)</span>
    <span class="op">}</span>
  <span class="op">}</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">trends</span><span class="op">)</span>
<span class="op">}</span>

<span class="co"># Run the wrapper function</span>
<span class="va">trends</span> <span class="op">&lt;-</span> <span class="fu">fasstr_trends_to_US_units</span><span class="op">(</span><span class="va">trends</span><span class="op">)</span></code></pre></div>
</div>
<div id="examples-frequency-analyses" class="section level3">
<h3 class="hasAnchor">
<a href="#examples-frequency-analyses" class="anchor"></a>Examples: frequency analyses</h3>
<p>There are several functions that perform various volume frequency analyses. Frequency analyses are used to determine probabilities of events of certain sizes (typically high or low flows). The analyses produce plots of event series and computed quantiles fitted from either Log-Pearson Type III or Weibull probability distributions. See the <a href="https://bcgov.github.io/fasstr/articles/fasstr_frequency_analysis.html">frequency analysis vignette</a> for more information. With the two options for probability distributions (logPIII and weibull), the user should have understanding or investigate the appropriateness of fit for the data provided with the probability distributions. The <code>fitdistrplus</code> R package fitting parameters can be found the in the <code>fasstr</code> ‘Freq_Fitting’ output and can be explored further (see <code>fitdistrplus</code> documentation for more information).</p>
<p>These functions do analyses on the data provided without requiring metric conversions. As such, the only fix required to format results in US units is changing the y-axis on the plot object from “Discharge (cms)” to desired units. Here are some examples that could be applied using USGS data. See documentation for default arguments (i.e. <code><a href="../../reference/compute_annual_frequencies.html">?compute_annual_frequencies</a></code>).</p>
<p>Compute annual low flows (1,3,7,and 30-day) frequencies with default arguments:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute annual low flows frequencies with default arguments</span>
<span class="va">lowflow_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/compute_annual_frequencies.html">compute_annual_frequencies</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                                                water_year_start <span class="op">=</span> <span class="fl">10</span>,
                                                prob_plot_position <span class="op">=</span> <span class="st">"weibull"</span>, <span class="co"># plot positions using (i)/(n+1)</span>
                                                fit_distr <span class="op">=</span> <span class="st">"PIII"</span>, <span class="co"># log-Pearson Type III</span>
                                                fit_distr_method <span class="op">=</span> <span class="st">"MOM"</span><span class="op">)</span> <span class="co"># method of moments</span>
<span class="co"># Change the y-axis of the plot to US units (changing the object itself)</span>
<span class="va">lowflow_frequency</span><span class="op">$</span><span class="va">Freq_Plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cubic feet per second"</span>

<span class="co"># View the fitting parameters (shape, scale, location, loglikehood, AIC and BIC etc.)</span>
<span class="co"># of the 7-day low flows</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">lowflow_frequency</span><span class="op">$</span><span class="va">Freq_Fitting</span><span class="op">$</span><span class="va">`7-Day`</span><span class="op">)</span>

<span class="co"># Plot the fitting distributions of the 7-day low flows</span>
<span class="fu"><a href="https://docs.ropensci.org/tidyhydat/reference/plot.html">plot</a></span><span class="op">(</span><span class="va">lowflow_frequency</span><span class="op">$</span><span class="va">Freq_Fitting</span><span class="op">$</span><span class="va">`7-Day`</span><span class="op">)</span></code></pre></div>
<p>Compute annual 1-day maximum frequencies with default arguments:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute annual daily peak flows frequencies with default arguments</span>
<span class="va">highflow_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/compute_annual_frequencies.html">compute_annual_frequencies</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                                                 water_year_start <span class="op">=</span> <span class="fl">10</span>,
                                                 use_max <span class="op">=</span> <span class="cn">TRUE</span>,
                                                 roll_days <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="co"># Change the y-axis of the plot to US units (changing the object itself)</span>
<span class="va">highflow_frequency</span><span class="op">$</span><span class="va">Freq_Plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cubic feet per second"</span>
<span class="va">highflow_frequency</span><span class="op">$</span><span class="va">Freq_Plot</span></code></pre></div>
<p>Compute summer 7-day low flow frequencies with default arguments:</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute summer low flow frequencies with default arguments</span>
<span class="va">lowflow_7day</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/compute_annual_frequencies.html">compute_annual_frequencies</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                                           water_year_start <span class="op">=</span> <span class="fl">10</span>,
                                           months <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span>,
                                           roll_days <span class="op">=</span> <span class="fl">7</span><span class="op">)</span>
<span class="co"># Extract the plot and change the y-axis title to US units (doesn't change the original)</span>
<span class="va">lowflow_plot</span> <span class="op">&lt;-</span> <span class="va">lowflow_7day</span><span class="op">$</span><span class="va">Freq_Plot</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Discharge, cubic feet per second"</span><span class="op">)</span></code></pre></div>
<p>Compute a frequency analysis on annual instantaneous peak data from NWIS using the custom frequency analysis function:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># dataRetrieval function to get annual instantaneous peak data, grouped by water years</span>
<span class="va">usgs_peaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISpeak.html">readNWISpeak</a></span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Measure <span class="op">=</span> <span class="st">"Inst. Peaks"</span><span class="op">)</span>

<span class="co"># Use the default column names for events and values for the custom analysis </span>
<span class="co"># and default arguments (log-PIII etc.)</span>
<span class="va">flood_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/compute_frequency_analysis.html">compute_frequency_analysis</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">usgs_peaks</span>,
                                              events <span class="op">=</span> <span class="va">peak_dt</span>,
                                              values <span class="op">=</span> <span class="va">peak_va</span>,
                                              measures <span class="op">=</span> <span class="va">Measure</span>,
                                              use_max <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="co"># Can also do the analysis with renaming parameters to match fasstr function, within a pipeline</span>
<span class="va">flood_frequency</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dataRetrieval/man/readNWISpeak.html">readNWISpeak</a></span><span class="op">(</span><span class="st">"12043300"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">peak_dt</span>, Value <span class="op">=</span> <span class="va">peak_va</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Measure <span class="op">=</span> <span class="st">"Inst. Peaks"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../../reference/compute_frequency_analysis.html">compute_frequency_analysis</a></span><span class="op">(</span>use_max <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">flood_frequency</span><span class="op">$</span><span class="va">Freq_Plot</span><span class="op">$</span><span class="va">labels</span><span class="op">$</span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Discharge, cubic feet per second"</span></code></pre></div>
<p>Compute a single frequency quantile with default arguments. With this function only the desired quantile is returned. Use this function if you know the fitting distributions are suitable for the data set.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Compute the summer 7Q10 with default arguments</span>
<span class="fu"><a href="../../reference/compute_frequency_quantile.html">compute_frequency_quantile</a></span><span class="op">(</span><span class="va">usgs_data</span>,
                           roll_days <span class="op">=</span> <span class="fl">7</span>, 
                           return_period <span class="op">=</span> <span class="fl">10</span>,
                           months <span class="op">=</span> <span class="fl">7</span><span class="op">:</span><span class="fl">9</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jon Goetz, Carl James Schwarz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
